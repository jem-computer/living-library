---
phase: 07-gsd-enhancements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/dependencies.js
  - package.json
autonomous: true

must_haves:
  truths:
    - "Phases from ROADMAP.md are extracted as graph nodes with status (complete/pending/active)"
    - "Dependencies from 'Depends on: Phase X' are extracted as directed edges"
    - "Each node has a URL for navigation to phase content"
  artifacts:
    - path: "src/lib/dependencies.js"
      provides: "Dependency graph data extraction"
      exports: ["buildDependencyGraph"]
      min_lines: 50
  key_links:
    - from: "src/lib/dependencies.js"
      to: "src/lib/milestones.js"
      via: "reuse phase parsing patterns"
      pattern: "parsePhases|getMilestones"
    - from: "src/lib/dependencies.js"
      to: "astro:content"
      via: "import getEntry"
      pattern: "getEntry.*planning"
---

<objective>
Create dependency graph extraction module that builds nodes and edges from ROADMAP.md phase relationships.

Purpose: GSD-06 requires a `/dependencies` page showing which phases block which
Output: src/lib/dependencies.js with buildDependencyGraph() returning { nodes, edges } for Cytoscape.js
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-gsd-enhancements/07-RESEARCH.md
@.planning/phases/07-gsd-enhancements/07-CONTEXT.md
@src/lib/milestones.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Cytoscape.js and cytoscape-dagre</name>
  <files>package.json</files>
  <action>
Install the graph visualization libraries:

```bash
npm install cytoscape cytoscape-dagre
```

- cytoscape: Core graph visualization library (mature, actively maintained)
- cytoscape-dagre: Extension for hierarchical DAG layouts (perfect for phase dependencies)

These will be used client-side in the dependencies page to render the interactive graph.
  </action>
  <verify>
Check package.json includes the dependencies:
```bash
grep -E "cytoscape" package.json
```
Should show both cytoscape and cytoscape-dagre.
  </verify>
  <done>cytoscape and cytoscape-dagre are in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create src/lib/dependencies.js with buildDependencyGraph function</name>
  <files>src/lib/dependencies.js</files>
  <action>
Create the dependency graph extraction module. Reuse patterns from milestones.js but extend for graph data.

The module should:

1. **Export buildDependencyGraph()** - async function returning `{ nodes, edges, milestones }`

2. **Extract phases from current ROADMAP.md**:
   - Use getEntry('planning', 'roadmap') like milestones.js
   - Parse phases using regex pattern: `/^###\s*Phase\s+(\d+):\s*([^\n✓]+)(✓)?/gm`
   - Extract phase content (between this header and next ### or ---)

3. **Build nodes array** - one per phase:
   ```javascript
   {
     id: `phase-${number}`,
     label: `Phase ${number}: ${name}`,
     status: 'complete' | 'active' | 'pending',
     milestone: 'v1.1',  // from milestone header
     url: `/phases/${paddedNumber}-${slugifiedName}/`
   }
   ```
   - Status logic: has ✓ or **Completed** date = 'complete', else check if any plan in-progress = 'active', else 'pending'
   - Determine 'active' by checking if it's the first incomplete phase

4. **Build edges array** - from "Depends on" lines:
   - Parse each phase content for: `**Depends on**:\s*Phase\s*(\d+)`
   - Also check for: `**Depends on**:\s*Nothing` (no edge)
   - Create edge: `{ source: 'phase-X', target: 'phase-Y' }`

5. **Handle multiple milestones**:
   - Also scan milestones/*.md archived roadmaps
   - Include milestone info in nodes for filtering

6. **Helper function slugify(name)**:
   - Convert "CLI Foundation & Dev Server" to "cli-foundation-dev-server"
   - Lowercase, replace spaces and special chars with hyphens

7. **Helper function padNumber(n)**:
   - Convert 1 to "01", 5 to "05", etc.

Example output:
```javascript
{
  nodes: [
    { id: 'phase-5', label: 'Phase 5: Distribution & Naming', status: 'complete', milestone: 'v1.1', url: '/phases/05-distribution-naming/' },
    { id: 'phase-6', label: 'Phase 6: Prettier Rendering', status: 'complete', milestone: 'v1.1', url: '/phases/06-prettier-rendering/' },
    { id: 'phase-7', label: 'Phase 7: GSD Enhancements', status: 'active', milestone: 'v1.1', url: '/phases/07-gsd-enhancements/' }
  ],
  edges: [
    { source: 'phase-5', target: 'phase-6' },
    { source: 'phase-6', target: 'phase-7' }
  ],
  milestones: ['v1.1', 'v1.0']
}
```

Use JSDoc type definitions for clarity.
  </action>
  <verify>
Test the module loads correctly:
```bash
node -e "
import('./src/lib/dependencies.js').then(m => {
  console.log('Module loaded, exports:', Object.keys(m));
}).catch(e => console.error('Module error:', e.message));
"
```
Should show 'buildDependencyGraph' in exports. Full integration test happens when page is built.
  </verify>
  <done>src/lib/dependencies.js exists with buildDependencyGraph() that extracts phases as nodes and dependencies as edges</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `src/lib/dependencies.js` exports buildDependencyGraph function
3. Module syntax is valid (no import errors)
4. JSDoc types are defined for Node and Edge objects
</verification>

<success_criteria>
- cytoscape and cytoscape-dagre in package.json
- src/lib/dependencies.js exists with buildDependencyGraph() export
- Function extracts phases from ROADMAP.md with correct status detection
- Dependencies parsed from "Depends on: Phase X" lines
- Nodes include URL for navigation
</success_criteria>

<output>
After completion, create `.planning/phases/07-gsd-enhancements/07-02-SUMMARY.md`
</output>
