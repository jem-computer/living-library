---
phase: 07-gsd-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/todos.js
  - package.json
autonomous: true

must_haves:
  truths:
    - "Standalone todo files from todos/pending/*.md are extracted with title, area, created date"
    - "Inline checkboxes from PLAN.md files are extracted with text, checked status, source plan"
    - "Todos are grouped by area (testing, general, etc.)"
  artifacts:
    - path: "src/lib/todos.js"
      provides: "Todo extraction and aggregation logic"
      exports: ["getTodos"]
      min_lines: 60
  key_links:
    - from: "src/lib/todos.js"
      to: "astro:content"
      via: "import getCollection"
      pattern: "getCollection.*planning"
    - from: "src/lib/todos.js"
      to: "remark-gfm"
      via: "unified pipeline"
      pattern: "remarkGfm"
---

<objective>
Create todo extraction module that aggregates todos from two sources: standalone todo files and inline checkboxes in PLAN.md files.

Purpose: GSD-05 requires a `/todos` page that collects todos from multiple sources
Output: src/lib/todos.js with getTodos() function that returns normalized todo objects
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-gsd-enhancements/07-RESEARCH.md
@.planning/phases/07-gsd-enhancements/07-CONTEXT.md
@.planning/todos/pending/2026-01-27-add-vitest-testing-framework.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install remark-gfm and unist-util-visit</name>
  <files>package.json</files>
  <action>
Install dependencies needed for parsing GFM task lists:

```bash
npm install remark-gfm unist-util-visit
```

These are used to parse markdown and extract `- [ ]` and `- [x]` checkboxes from PLAN.md files. remark-gfm is the official plugin for GitHub Flavored Markdown including task lists. unist-util-visit provides AST traversal.

Note: unified and remark-parse are likely already available via Astro's internal dependencies, but remark-gfm and unist-util-visit must be explicitly installed.
  </action>
  <verify>
Check package.json includes the new dependencies:
```bash
grep -E "remark-gfm|unist-util-visit" package.json
```
Both should appear in dependencies section.
  </verify>
  <done>remark-gfm and unist-util-visit are in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create src/lib/todos.js with getTodos function</name>
  <files>src/lib/todos.js</files>
  <action>
Create the todo extraction module. Follow the pattern from milestones.js for content collection access.

The module should:

1. **Export getTodos()** - async function returning array of todo objects

2. **Extract standalone todos** from `todos/pending/*.md`:
   - Filter collection for files matching `todos/pending/`
   - Read frontmatter: title, area, created, files
   - Return objects: `{ title, area, created, source: 'standalone', file: doc.id, checked: false }`

3. **Extract inline checkboxes** from `*-PLAN.md` files:
   - Filter collection for files matching `/-PLAN\.md$/`
   - Parse markdown body with unified + remark-parse + remark-gfm
   - Use visit() to find listItem nodes where `node.checked !== null`
   - Extract text content from the list item
   - Derive area from plan path (e.g., `phases/06-prettier-rendering/06-01-PLAN.md` -> "prettier-rendering")
   - Return objects: `{ title: text, area, created: null, source: doc.id, checked: node.checked }`

4. **Helper function extractTextFromNode(node)**:
   - Recursively extract text from node.children
   - Handle text, inlineCode, link, emphasis, strong nodes
   - Return concatenated string

5. **Group and sort**:
   - Default return: all todos array (grouping done at page level)
   - Sort by: unchecked first, then by area, then by created date (newest first)

Example todo object structure:
```javascript
{
  title: "Add vitest & @testing-library for testing",
  area: "testing",
  created: "2026-01-27T17:56",
  source: "standalone", // or "phases/07.../07-01-PLAN.md"
  file: "todos/pending/2026-01-27-add-vitest-testing-framework.md",
  checked: false
}
```

Use JSDoc type definitions like milestones.js does for clarity.
  </action>
  <verify>
Test the module works by creating a quick test script:
```bash
node -e "
import('./src/lib/todos.js').then(m => {
  console.log('Module loaded, exports:', Object.keys(m));
}).catch(e => console.error('Module error:', e.message));
"
```
Should show 'getTodos' in exports. Full integration test happens when page is built.
  </verify>
  <done>src/lib/todos.js exists with getTodos() that extracts todos from both standalone files and PLAN.md checkboxes</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `src/lib/todos.js` exports getTodos function
3. Module syntax is valid (no import errors)
4. JSDoc types are defined for Todo objects
</verification>

<success_criteria>
- remark-gfm and unist-util-visit in package.json
- src/lib/todos.js exists with getTodos() export
- Function handles both standalone todo files and PLAN.md checkbox extraction
- Text extraction handles nested inline formatting (bold, code, links)
</success_criteria>

<output>
After completion, create `.planning/phases/07-gsd-enhancements/07-01-SUMMARY.md`
</output>
