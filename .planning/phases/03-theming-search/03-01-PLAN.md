---
phase: 03-theming-search
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/global.css
  - astro.config.mjs
autonomous: true

must_haves:
  truths:
    - "Site displays with light theme by default"
    - "Dark theme CSS variables are defined and ready to use"
    - "Code blocks have dual themes configured for light/dark"
  artifacts:
    - path: "src/styles/global.css"
      provides: "CSS custom properties for light and dark themes"
      contains: ".dark"
    - path: "astro.config.mjs"
      provides: "Shiki dual theme configuration"
      contains: "themes:"
  key_links:
    - from: "src/styles/global.css"
      to: ".dark class on html"
      via: "CSS selector"
      pattern: "\\.dark\\s*\\{"
---

<objective>
Establish CSS custom property foundation for theming and configure Shiki dual themes.

Purpose: Creates the styling foundation that enables light/dark theme switching without FOUC. All color values become CSS variables that respond to a `.dark` class on `<html>`.
Output: Updated global.css with theme variables and dark overrides, astro.config.mjs with dual Shiki themes configured.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-theming-search/03-RESEARCH.md

Key patterns from research:
- CSS variables in :root for light theme (default)
- .dark class overrides for dark theme
- Shiki themes: { light: 'github-light', dark: 'github-dark' }
- Dark code blocks: .dark .astro-code with shiki CSS variables
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor global.css with theme variables</name>
  <files>src/styles/global.css</files>
  <action>
Refactor the existing CSS custom properties section to support theming:

1. Keep existing :root variables but organize into semantic groups:
   - Layout dimensions (unchanged)
   - Light theme colors (current values, clearly labeled)
   - Spacing (unchanged)
   - Typography (unchanged)
   - Transitions (unchanged)

2. Add .dark class selector AFTER :root with dark theme overrides:
   ```css
   .dark {
     --bg-primary: #1a1a1a;
     --bg-secondary: #242424;
     --bg-hover: #2a2a2a;
     --text-primary: #f0f0f0;
     --text-secondary: #b0b0b0;
     --text-muted: #808080;
     --border-color: #333333;
     --link-color: #58a6ff;
     --link-hover: #79b8ff;
     --code-bg: #161b22;
     --code-border: #30363d;
   }
   ```

3. Add Shiki dark mode CSS at the end of the file:
   ```css
   /* Shiki code block dark mode */
   .dark .astro-code,
   .dark .astro-code span {
     color: var(--shiki-dark) !important;
     background-color: var(--shiki-dark-bg) !important;
     font-style: var(--shiki-dark-font-style) !important;
     font-weight: var(--shiki-dark-font-weight) !important;
     text-decoration: var(--shiki-dark-text-decoration) !important;
   }
   ```

4. Add smooth transition for theme switching on body:
   ```css
   body {
     /* existing styles... */
     transition: background-color 0.2s ease, color 0.2s ease;
   }
   ```

DO NOT change any layout, spacing, or non-color related styles.
  </action>
  <verify>
Run `grep -c ".dark" src/styles/global.css` - should return >= 2 (class definition + shiki selector).
Visually verify CSS is valid by checking dev server still loads without errors.
  </verify>
  <done>
global.css contains :root light theme variables, .dark class dark theme overrides, and Shiki dark mode CSS selector.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Shiki dual themes</name>
  <files>astro.config.mjs</files>
  <action>
Update the shikiConfig in astro.config.mjs to use dual themes:

Change from:
```js
shikiConfig: {
  theme: 'github-light',
  wrap: true
}
```

To:
```js
shikiConfig: {
  themes: {
    light: 'github-light',
    dark: 'github-dark',
  },
  wrap: true
}
```

Note: Use `themes` (plural) object with light/dark keys, NOT `theme` (singular).
This tells Shiki to output CSS variables (--shiki-dark, --shiki-dark-bg, etc.) that our CSS can use.
  </action>
  <verify>
Run `grep -A3 "shikiConfig" astro.config.mjs` - should show themes object with light and dark keys.
Start dev server and verify code blocks render without errors.
  </verify>
  <done>
astro.config.mjs has shikiConfig with dual themes (github-light and github-dark) configured.
  </done>
</task>

</tasks>

<verification>
1. Dev server starts without errors: `npm run dev`
2. Site loads with light theme colors (white background, dark text)
3. Code blocks render with syntax highlighting
4. CSS file contains .dark class with all theme overrides
5. astro.config.mjs has themes: { light, dark } configuration
</verification>

<success_criteria>
- Light theme displays correctly (current behavior preserved)
- Dark theme CSS variables are defined (not yet active, just ready)
- Shiki dual themes configured (CSS variables generated in code blocks)
- No visual regressions from Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/03-theming-search/03-01-SUMMARY.md`
</output>
