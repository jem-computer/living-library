---
phase: 03-theming-search
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/Search.astro
autonomous: true

must_haves:
  truths:
    - "astro-pagefind is installed as a dependency"
    - "Search component exists and is ready for use"
  artifacts:
    - path: "package.json"
      provides: "astro-pagefind dependency"
      contains: "astro-pagefind"
    - path: "src/components/Search.astro"
      provides: "Search UI component wrapper"
      contains: "astro-pagefind"
  key_links:
    - from: "src/components/Search.astro"
      to: "astro-pagefind/components/Search"
      via: "import"
      pattern: "from.*astro-pagefind"
---

<objective>
Install Pagefind integration and create Search component.

Purpose: Adds the search dependency and creates a reusable Search component. This plan handles the dependency/component side, while Plan 03 handles the integration into the layout.
Output: astro-pagefind installed, Search.astro component ready for use in header.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-theming-search/03-RESEARCH.md

Key patterns from research:
- astro-pagefind v1.8.5 for Pagefind integration
- Search component from astro-pagefind/components/Search
- uiOptions: showImages: false, excerptLength: 30, pageSize: 5
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install astro-pagefind</name>
  <files>package.json</files>
  <action>
Install astro-pagefind package:

```bash
cd /Users/jem/code/111ecosystem/living-library && npm install astro-pagefind
```

This adds astro-pagefind to dependencies. The integration will be added to astro.config.mjs in Plan 03 (needs to be last integration).
  </action>
  <verify>
Run `grep "astro-pagefind" package.json` - should show the dependency with version.
Run `ls node_modules/astro-pagefind` - should exist.
  </verify>
  <done>
astro-pagefind is listed in package.json dependencies and installed in node_modules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Search component</name>
  <files>src/components/Search.astro</files>
  <action>
Create a Search component that wraps astro-pagefind's Search component with custom styling:

```astro
---
/**
 * Search Component
 * Wraps astro-pagefind Search with Living Library styling
 */
import PagefindSearch from "astro-pagefind/components/Search";
---

<div class="search-wrapper">
  <PagefindSearch
    id="search"
    className="pagefind-ui"
    uiOptions={{
      showImages: false,
      excerptLength: 30,
      pageSize: 5,
      showSubResults: true,
      placeholder: "Search docs..."
    }}
  />
</div>

<style>
  .search-wrapper {
    position: relative;
  }

  /* Pagefind UI Customization */
  .search-wrapper :global(.pagefind-ui) {
    --pagefind-ui-scale: 0.9;
    --pagefind-ui-primary: var(--link-color);
    --pagefind-ui-text: var(--text-primary);
    --pagefind-ui-background: var(--bg-primary);
    --pagefind-ui-border: var(--border-color);
    --pagefind-ui-tag: var(--bg-secondary);
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 6px;
    --pagefind-ui-font: inherit;
  }

  /* Search input styling */
  .search-wrapper :global(.pagefind-ui__search-input) {
    height: 36px;
    font-size: var(--font-size-sm);
  }

  /* Results dropdown styling */
  .search-wrapper :global(.pagefind-ui__results-area) {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 200;
    margin-top: 4px;
    max-height: 400px;
    overflow-y: auto;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Result item styling */
  .search-wrapper :global(.pagefind-ui__result) {
    padding: var(--spacing-sm) var(--spacing-md);
    border-bottom: 1px solid var(--border-color);
  }

  .search-wrapper :global(.pagefind-ui__result:last-child) {
    border-bottom: none;
  }

  .search-wrapper :global(.pagefind-ui__result-link) {
    color: var(--link-color);
    font-weight: 500;
  }

  .search-wrapper :global(.pagefind-ui__result-excerpt) {
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
  }

  /* Highlight matches */
  .search-wrapper :global(mark) {
    background-color: rgba(255, 220, 0, 0.3);
    color: inherit;
    padding: 0 2px;
    border-radius: 2px;
  }

  /* Dark mode adjustments */
  :global(.dark) .search-wrapper :global(mark) {
    background-color: rgba(255, 220, 0, 0.2);
  }
</style>
```

Key decisions:
- Use CSS variables from global.css for consistent theming
- Override Pagefind UI CSS variables to match site theme
- Position results as absolute dropdown below input
- Add dark mode mark highlighting adjustment
  </action>
  <verify>
Run `cat src/components/Search.astro` - should contain PagefindSearch import and styling.
File should compile without TypeScript errors (check with dev server).
  </verify>
  <done>
Search.astro component exists with Pagefind wrapper and Living Library styling that respects theme variables.
  </done>
</task>

</tasks>

<verification>
1. `npm ls astro-pagefind` shows installed package
2. src/components/Search.astro exists with proper imports
3. Dev server starts without errors (component syntax valid)
4. Search component uses CSS variables for theming
</verification>

<success_criteria>
- astro-pagefind installed and in package.json
- Search.astro component created with proper styling
- Component ready for integration into header (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/03-theming-search/03-02-SUMMARY.md`
</output>
