---
phase: 02-content-navigation
plan: 04
type: execute
wave: 2
depends_on:
  - 02-02
files_modified:
  - src/components/Sidebar.astro
  - src/layouts/DocLayout.astro
  - src/styles/global.css
autonomous: false

must_haves:
  truths:
    - "Current page is highlighted in sidebar"
    - "Current page scrolls into view on page load"
    - "Folders expand/collapse on click"
    - "Mobile hamburger menu toggles sidebar visibility"
  artifacts:
    - path: "src/components/Sidebar.astro"
      provides: "Interactive sidebar with expand/collapse"
      contains: "aria-expanded"
    - path: "src/layouts/DocLayout.astro"
      provides: "Mobile menu toggle functionality"
      contains: "data-menu-toggle"
  key_links:
    - from: "src/components/Sidebar.astro"
      to: "vanilla JS"
      via: "script tag event listeners"
      pattern: "addEventListener.*click"
    - from: "src/layouts/DocLayout.astro"
      to: "vanilla JS"
      via: "mobile menu toggle script"
      pattern: "classList.toggle"
---

<objective>
Add client-side interactivity for sidebar navigation: folder expand/collapse, current page highlighting, scroll into view, and mobile menu toggle.

Purpose: Make navigation fully functional and usable
Output: Interactive sidebar with all UX polish
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-content-navigation/02-CONTEXT.md
@.planning/phases/02-content-navigation/02-RESEARCH.md
@.planning/phases/02-content-navigation/02-02-SUMMARY.md (if exists)

Key research patterns:
- Pattern 5: Client-Side Interactivity with Script Tags
- Pitfall 6: Script Tags Run Multiple Times - use delegation or check listeners
- Use data-* attributes for JS hooks
- aria-expanded for accessibility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance sidebar with interactivity</name>
  <files>src/components/Sidebar.astro, src/styles/global.css</files>
  <action>
    1. Update Sidebar.astro script section:
       - Folder toggle: click button toggles aria-expanded and shows/hides children
       - Rotate icon indicator (triangle/chevron)
       - Auto-expand folders containing current page on page load
       - scrollIntoView() for current page link after load

    2. Add to global.css:
       - Styles for expanded/collapsed folders
       - Current page highlight (background color, font weight)
       - Smooth transition for expand/collapse
       - Icon rotation animation

    3. Accessibility:
       - aria-expanded on folder buttons
       - aria-current="page" on current page link
       - Focus states for keyboard navigation
       - Hidden attribute for collapsed content

    Reference research Pattern 5 for exact implementation.
    Avoid pitfall 6 - use event delegation or guard against duplicate listeners.
  </action>
  <verify>
    Click folder toggles show/hide children.
    Current page is highlighted.
    Current page scrolls into view on page load.
  </verify>
  <done>
    Sidebar folders expand/collapse correctly.
    Current page highlighted and visible.
    Accessible with keyboard.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire mobile menu functionality</name>
  <files>src/layouts/DocLayout.astro, src/styles/global.css</files>
  <action>
    1. Update DocLayout.astro script section:
       - Menu toggle button adds/removes 'open' class on sidebar
       - Click outside sidebar closes it (optional enhancement)
       - ESC key closes sidebar (accessibility)

    2. Add to global.css:
       - Mobile sidebar styles when .open class present
       - Slide-in animation from left
       - Overlay/backdrop behind open sidebar (semi-transparent)
       - Hamburger icon styling (three lines)
       - Transform to X when menu open (optional)

    3. Accessibility:
       - aria-expanded on toggle button
       - Focus trap within open sidebar (optional)
       - Visible focus states
  </action>
  <verify>
    On mobile viewport (resize browser < 768px):
    - Sidebar hidden by default
    - Hamburger button visible
    - Click hamburger opens sidebar
    - Click hamburger again closes it
  </verify>
  <done>
    Mobile navigation fully functional.
    Sidebar slides in/out smoothly.
    Touch-friendly tap targets.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Interactive sidebar navigation with:
    - Collapsible folders
    - Current page highlighting
    - Mobile hamburger menu
    - Responsive layout (1/2/3 columns)
  </what-built>
  <how-to-verify>
    1. Start dev server: `npm run dev`
    2. Open http://localhost:4321 in browser
    3. Desktop checks (width > 1024px):
       - See 3-column layout (sidebar, content, TOC)
       - Click folder to expand/collapse
       - Current page is highlighted
       - Navigate to different page, highlight updates
    4. Tablet checks (768px - 1024px):
       - Resize window or use DevTools
       - See 2-column layout (sidebar, content)
       - TOC should be hidden
    5. Mobile checks (< 768px):
       - Both sidebars hidden
       - Hamburger menu visible in header
       - Click hamburger - sidebar slides in
       - Click hamburger again - sidebar closes
       - Can navigate using mobile sidebar
    6. Navigate between pages - internal links work
  </how-to-verify>
  <resume-signal>Type "approved" if navigation works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Folder expand/collapse works on all folders
2. Current page highlighted in sidebar
3. Mobile menu opens/closes correctly
4. Responsive breakpoints work at 768px and 1024px
5. Keyboard navigation functional (Tab, Enter, Escape)
</verification>

<success_criteria>
- Full navigation interactivity on desktop and mobile
- Clean, polished UX matching GitBook-style aesthetic
- Accessible (aria attributes, keyboard nav)
- No JavaScript errors in console
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-navigation/02-04-SUMMARY.md`
</output>
