---
phase: 05-distribution-naming
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - README.md
autonomous: false

user_setup:
  - service: npm
    why: "Publishing package to npm registry"
    env_vars: []
    dashboard_config:
      - task: "Ensure npm account exists and you're logged in"
        location: "Run `npm whoami` to verify, `npm login` if needed"

must_haves:
  truths:
    - "npx living-library works in a fresh directory with .planning folder"
    - "Dev server starts and shows content from user's .planning directory"
    - "Build command creates static site from user's .planning directory"
    - "Package is published and installable from npm registry"
  artifacts:
    - path: "README.md"
      provides: "Accurate usage instructions"
      contains: "npx living-library"
    - path: "npm package (published)"
      provides: "Installable package on npm"
  key_links:
    - from: "npx living-library"
      to: "user's .planning folder"
      via: "PLANNING_ROOT env var"
      pattern: "content from user directory loads"
---

<objective>
Test the path resolution fix with npm pack and publish to npm registry.

Purpose: Verify the changes from Plan 01 actually work when the package is installed via npm (not just local development), then publish so real users can install it.

Output: Verified working npm package published to registry.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-distribution-naming/05-RESEARCH.md
@.planning/phases/05-distribution-naming/05-01-SUMMARY.md

@package.json
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create and test npm pack tarball</name>
  <files></files>
  <action>
Follow the npm pack testing workflow from research:

1. Create the tarball:
```bash
npm pack --pack-destination /tmp
```
This creates /tmp/living-library-1.0.0.tgz

2. Create a completely separate test directory:
```bash
mkdir -p /tmp/test-living-library-npm
cd /tmp/test-living-library-npm
```

3. Create minimal .planning content:
```bash
mkdir .planning
echo "# Test Planning Doc" > .planning/README.md
echo "This is test content to verify npm distribution works." >> .planning/README.md
```

4. Install from tarball:
```bash
npm install /tmp/living-library-1.0.0.tgz
```

5. Test dev server:
```bash
npx living-library &
# Wait for server to start (check for localhost URL)
# Then curl or verify it responds
sleep 5
curl -s http://localhost:4321 | head -20
# Should show HTML with "Test Planning Doc" somewhere
# Kill the server
pkill -f "living-library"
```

6. Test build command:
```bash
npx living-library build
# Should create dist/ folder
ls -la dist/
```

If any step fails, investigate and report the error. The path resolution fix should make this work.
  </action>
  <verify>
1. Tarball exists at /tmp/living-library-1.0.0.tgz
2. Dev server starts without "ENOENT .planning" errors
3. Curl shows HTML content (not error page)
4. Build completes without errors
5. dist/ folder is created with index.html
  </verify>
  <done>npm pack tarball tested successfully in external directory</done>
</task>

<task type="auto">
  <name>Task 2: Verify README accuracy</name>
  <files>README.md</files>
  <action>
Review README.md and verify:

1. Package name is `living-library` (matches package.json)
2. Usage examples show `npx living-library` (correct)
3. CLI options are accurate
4. No outdated information

If any issues found, update README.md to be accurate.

The current README should be correct since the package name hasn't changed, but verify after testing that the usage instructions actually work.
  </action>
  <verify>
1. Read README.md
2. Package name matches package.json
3. Commands shown in README match actual CLI behavior
  </verify>
  <done>README accurately reflects package name and usage</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
npm distribution fix tested and verified:
- Path resolution now uses PLANNING_ROOT env var
- npm pack tarball tested in external directory
- Dev server and build command both work when installed via npm
- README verified accurate
  </what-built>
  <how-to-verify>
1. The test results above should show successful dev server and build
2. If you want to manually verify:
   ```bash
   cd /tmp/test-living-library-npm
   npx living-library
   # Visit http://localhost:4321 in browser
   # Should see "Test Planning Doc" rendered
   ```
3. Confirm you're ready to publish to npm

Before approving, verify:
- Are you logged into npm? (`npm whoami`)
- Is the package name "living-library" available? (Research confirmed yes)
- Ready to make this public?
  </how-to-verify>
  <resume-signal>Type "publish" to proceed with npm publish, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 4: Publish to npm</name>
  <files></files>
  <action>
After checkpoint approval, publish the package:

```bash
cd /Users/jem/code/111ecosystem/living-library
npm publish --access public
```

The `--access public` flag is required for scoped packages or first-time publishes to ensure the package is public.

After successful publish, verify:
```bash
npm view living-library
```

This should show the package metadata from the npm registry.
  </action>
  <verify>
1. `npm publish` exits with code 0
2. `npm view living-library` shows package info
3. Version is 1.0.0
  </verify>
  <done>Package published to npm registry as living-library@1.0.0</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm view living-library` returns package info
2. In a NEW directory: `npx living-library@1.0.0` works (tests npm registry install)
3. Package is publicly accessible on npmjs.com/package/living-library
</verification>

<success_criteria>
- [ ] npm pack tarball installs and runs in external directory
- [ ] Dev server starts and loads user's .planning content
- [ ] Build command creates static site
- [ ] README is accurate
- [ ] Package published to npm as living-library
- [ ] `npm view living-library` shows package
- [ ] `npx living-library` works from npm registry (not just local tarball)
</success_criteria>

<output>
After completion, create `.planning/phases/05-distribution-naming/05-02-SUMMARY.md`
</output>
