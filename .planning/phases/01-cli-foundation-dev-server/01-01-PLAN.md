---
phase: 01-cli-foundation-dev-server
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - bin/living-library.js
  - src/cli.js
  - src/detect-planning.js
autonomous: true

must_haves:
  truths:
    - "npm install completes without errors"
    - "bin/living-library.js is executable entry point"
    - "Detection module finds .planning folder from cwd or parent directories"
  artifacts:
    - path: "package.json"
      provides: "npm package with bin field and dependencies"
      contains: '"bin":'
    - path: "bin/living-library.js"
      provides: "Shebang entry point"
      contains: "#!/usr/bin/env node"
    - path: "src/detect-planning.js"
      provides: "Directory detection with find-up"
      exports:
        - detectPlanningDir
    - path: "src/cli.js"
      provides: "CLI skeleton with parseArgs"
      exports:
        - run
  key_links:
    - from: "bin/living-library.js"
      to: "src/cli.js"
      via: "dynamic import"
      pattern: "import.*cli"
---

<objective>
Initialize the living-library npm package with proper ESM configuration, bin field for npx execution, and core detection module for finding .planning folders.

Purpose: Establish the foundation all other plans build upon - a valid npm package that can be executed via npx.
Output: Working package.json with dependencies, executable entry point, and .planning detection module.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cli-foundation-dev-server/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize npm package with dependencies</name>
  <files>package.json, tsconfig.json</files>
  <action>
Create package.json with:
- name: "living-library"
- version: "0.1.0"
- type: "module" (ESM)
- bin: { "living-library": "./bin/living-library.js" }
- files: ["bin", "src"] (for npm pack)
- dependencies: astro@^5.16.11, get-port, find-up, picocolors, ora, @inquirer/prompts
- engines: { "node": ">=18.0.0" }
- scripts: { "dev": "node bin/living-library.js" }

Create tsconfig.json with:
- target: "ES2022"
- module: "NodeNext"
- moduleResolution: "NodeNext"
- allowJs: true, checkJs: false
- outDir: "dist" (for future builds)
- rootDir: "."

Run `npm install` to install dependencies.

DO NOT use TypeScript compilation for now - use .js files with JSDoc comments for type hints. This keeps the package simple and avoids build step complexity.
  </action>
  <verify>
Run: `npm install` - completes without errors
Run: `npm pack --dry-run` - shows bin/living-library.js in package
Run: `node -e "import('get-port').then(() => console.log('deps ok'))"` - imports resolve
  </verify>
  <done>
package.json exists with correct bin field, type: module, and all dependencies installed. tsconfig.json exists. node_modules populated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create entry points and detection module</name>
  <files>bin/living-library.js, src/cli.js, src/detect-planning.js</files>
  <action>
Create bin/living-library.js:
```javascript
#!/usr/bin/env node

import('../src/cli.js').then(m => m.run()).catch(err => {
  console.error(err);
  process.exit(1);
});
```

Create src/detect-planning.js:
```javascript
import { findUp } from 'find-up';
import path from 'node:path';

/**
 * Detect .planning directory, walking up from cwd
 * @returns {Promise<{path: string, relative: string} | null>}
 */
export async function detectPlanningDir() {
  const planningPath = await findUp('.planning', {
    cwd: process.cwd(),
    type: 'directory'
  });

  if (!planningPath) {
    return null;
  }

  // Get parent directory (the project root containing .planning)
  const projectRoot = path.dirname(planningPath);
  const relativePath = path.relative(process.cwd(), planningPath);

  return {
    path: projectRoot,
    planningPath,
    relative: relativePath || '.planning',
    isMonorepo: relativePath !== '.planning' && relativePath !== ''
  };
}
```

Create src/cli.js (skeleton):
```javascript
import { parseArgs } from 'node:util';

/**
 * CLI entry point
 */
export async function run() {
  const { values } = parseArgs({
    options: {
      verbose: { type: 'boolean', short: 'v', default: false },
      help: { type: 'boolean', short: 'h', default: false },
      version: { type: 'boolean', default: false }
    },
    strict: false,
    allowPositionals: true
  });

  if (values.help) {
    printHelp();
    return;
  }

  if (values.version) {
    const pkg = await import('../package.json', { with: { type: 'json' } });
    console.log(pkg.default.version);
    return;
  }

  // Placeholder - will be wired in Plan 03
  console.log('living-library dev server (not yet implemented)');
  console.log('Options:', values);
}

function printHelp() {
  console.log(`
living-library - Documentation viewer for .planning folders

Usage:
  npx living-library [options]

Options:
  -v, --verbose  Show detailed Astro output
  -h, --help     Show this help message
  --version      Show version number

Run in a directory with a .planning folder to start the dev server.
`);
}
```
  </action>
  <verify>
Run: `node bin/living-library.js --help` - shows help text
Run: `node bin/living-library.js --version` - shows "0.1.0"
Run: `node -e "import('./src/detect-planning.js').then(m => m.detectPlanningDir().then(r => console.log(r)))"` - returns object with .planning path (or null)
  </verify>
  <done>
- bin/living-library.js exists with shebang, imports and runs cli.js
- src/cli.js exports run(), handles --help, --verbose, --version flags
- src/detect-planning.js exports detectPlanningDir() that returns {path, relative, isMonorepo} or null
- All three files work together when run via `node bin/living-library.js`
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm install` - no errors
2. `node bin/living-library.js --help` - shows help
3. `node bin/living-library.js --version` - shows 0.1.0
4. From this project root: detection finds `.planning` folder
5. `npm pack --dry-run` - lists bin/ and src/ files
</verification>

<success_criteria>
- package.json has bin field pointing to bin/living-library.js
- All dependencies (astro, get-port, find-up, picocolors, ora, @inquirer/prompts) installed
- CLI can be invoked and responds to --help and --version
- Detection module correctly finds .planning in current or parent directories
- Project structure follows ESM conventions (type: module)
</success_criteria>

<output>
After completion, create `.planning/phases/01-cli-foundation-dev-server/01-01-SUMMARY.md`
</output>
