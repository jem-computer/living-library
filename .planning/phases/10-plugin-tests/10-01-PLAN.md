---
phase: 10-plugin-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - test/unit/plugins/remark-gsd-links.test.ts
  - test/unit/plugins/remark-normalize-gsd-tags.test.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "remarkGsdLinks transforms @.planning/ROADMAP.md to clickable link"
    - "remarkGsdLinks converts @/absolute/path to styled span"
    - "remarkNormalizeGsdTags normalizes underscores to hyphens in tag names"
    - "remarkNormalizeGsdTags converts paragraph nodes containing GSD tags to html nodes"
    - "Tests run against markdown strings via remark processor, not Astro builds"
  artifacts:
    - path: "test/unit/plugins/remark-gsd-links.test.ts"
      provides: "Unit tests for remarkGsdLinks transformations"
      min_lines: 60
    - path: "test/unit/plugins/remark-normalize-gsd-tags.test.ts"
      provides: "Unit tests for remarkNormalizeGsdTags transformations"
      min_lines: 60
  key_links:
    - from: "test/unit/plugins/remark-gsd-links.test.ts"
      to: "src/plugins/remark-gsd-links.js"
      via: "import remarkGsdLinks"
      pattern: "import.*remarkGsdLinks.*from"
    - from: "test/unit/plugins/remark-normalize-gsd-tags.test.ts"
      to: "src/plugins/remark-normalize-gsd-tags.js"
      via: "import remarkNormalizeGsdTags"
      pattern: "import.*remarkNormalizeGsdTags.*from"
---

<objective>
Unit tests for remark plugins: remarkGsdLinks and remarkNormalizeGsdTags

Purpose: Verify remark plugins correctly transform @path references and normalize GSD tags using unified processor pipeline (not Astro builds)
Output: Two test files covering success criteria transformations + edge cases
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-plugin-tests/10-RESEARCH.md
@src/plugins/remark-gsd-links.js
@src/plugins/remark-normalize-gsd-tags.js
@test/setup.ts
@test/unit/lib/milestones.test.ts (for test patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install test dependencies and create remarkGsdLinks tests</name>
  <files>package.json, test/unit/plugins/remark-gsd-links.test.ts</files>
  <action>
1. Install dev dependencies for unified plugin testing:
   ```bash
   npm install --save-dev unified remark remark-parse remark-stringify rehype rehype-parse rehype-stringify remark-rehype
   ```

2. Create `test/unit/plugins/` directory

3. Create `test/unit/plugins/remark-gsd-links.test.ts` with tests covering:

**Internal planning links (RENDER-01):**
- `@.planning/ROADMAP.md` transforms to `[@.planning/ROADMAP.md](/roadmap)`
- `@.planning/phases/06-prettier-rendering/06-RESEARCH.md` transforms to link with slug `/phases/06-prettier-rendering/06-research`
- Multiple internal refs on one line all transform

**External file references (RENDER-02):**
- `@/Users/path/file.md` transforms to `<span class="gsd-external-ref">@/Users/path/file.md</span>`
- Multiple external refs on one line all transform

**Edge cases:**
- `@username` without path separator does NOT transform (not a path reference)
- Mixed internal and external refs in same line both transform correctly
- Refs at start of line, middle, and end all work
- Refs followed by punctuation (period, comma, paren) work
- Refs in parentheses `(@.planning/FILE.md)` work

Use synchronous `processSync()` since plugins are sync. Follow Phase 9 test patterns with explicit assertions.
  </action>
  <verify>Run `npm test -- test/unit/plugins/remark-gsd-links.test.ts` - all tests pass</verify>
  <done>remarkGsdLinks has passing tests for internal links, external refs, and edge cases</done>
</task>

<task type="auto">
  <name>Task 2: Create remarkNormalizeGsdTags tests</name>
  <files>test/unit/plugins/remark-normalize-gsd-tags.test.ts</files>
  <action>
Create `test/unit/plugins/remark-normalize-gsd-tags.test.ts` with tests covering:

**Underscore to hyphen normalization:**
- `<execution_context>` becomes `<execution-context>`
- `<success_criteria>` becomes `<success-criteria>`
- Closing tags also normalize: `</execution_context>` becomes `</execution-context>`
- Tags without underscores pass through unchanged

**Paragraph to HTML node conversion:**
- Paragraph containing only `<objective>content</objective>` converts to html node
- Tags in the recognized list are converted: objective, process, execution_context, success_criteria, context, tasks, task, verification, output, name, action, files, done, behavior, implementation
- Paragraph with multiple children (text + other nodes) is NOT converted

**Edge cases:**
- Tags inside code blocks are NOT transformed (preserved as code)
- Nested tags work: `<task><action>content</action></task>`
- Tag with attributes: `<task type="auto">content</task>`
- Empty tags: `<objective></objective>`
- Multiline content inside tags

Test pipeline: Use `unified().use(remarkParse).use(remarkNormalizeGsdTags).use(remarkRehype, { allowDangerousHtml: true }).use(rehypeStringify)` to verify full transformation. Use `remark().use(remarkNormalizeGsdTags).processSync()` for markdown-only tests.
  </action>
  <verify>Run `npm test -- test/unit/plugins/remark-normalize-gsd-tags.test.ts` - all tests pass</verify>
  <done>remarkNormalizeGsdTags has passing tests for underscore normalization, paragraph conversion, and edge cases</done>
</task>

</tasks>

<verification>
```bash
# Run all plugin tests
npm test -- test/unit/plugins/

# Check coverage for remark plugins
npm run coverage -- --reporter=text test/unit/plugins/
```

Expected: Both test files pass, coverage shows remark plugins are tested.
</verification>

<success_criteria>
1. `npm install` adds unified ecosystem packages to devDependencies
2. `test/unit/plugins/remark-gsd-links.test.ts` exists with 8+ test cases
3. `test/unit/plugins/remark-normalize-gsd-tags.test.ts` exists with 8+ test cases
4. All tests pass with explicit assertions (no snapshots)
5. Tests process markdown strings through unified pipeline (not Astro builds)
</success_criteria>

<output>
After completion, create `.planning/phases/10-plugin-tests/10-01-SUMMARY.md`
</output>
