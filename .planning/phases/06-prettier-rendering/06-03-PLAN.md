---
phase: 06-prettier-rendering
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - astro.config.mjs
  - src/styles/gsd-blocks.css
  - src/styles/global.css
autonomous: true

must_haves:
  truths:
    - "@.planning/ROADMAP.md renders as clickable link in browser"
    - "@/Users/path/file.md renders as styled external indicator"
    - "<objective> blocks have visible border and background"
    - "<process> blocks have visible styling distinct from objective"
    - "<execution_context> blocks are collapsible and styled"
    - "All GSD blocks have consistent professional appearance"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Plugin registration"
      contains: "remarkGsdLinks"
    - path: "src/styles/gsd-blocks.css"
      provides: "CSS styles for GSD blocks"
      min_lines: 80
  key_links:
    - from: "astro.config.mjs"
      to: "src/plugins/remark-gsd-links.js"
      via: "import"
      pattern: "remarkGsdLinks"
    - from: "astro.config.mjs"
      to: "src/plugins/rehype-gsd-blocks.js"
      via: "import"
      pattern: "rehypeGsdBlocks"
    - from: "src/styles/global.css"
      to: "src/styles/gsd-blocks.css"
      via: "import"
      pattern: "@import"
---

<objective>
Wire plugins into Astro configuration and add CSS styles for GSD blocks.

Purpose: Connect the plugins created in Plans 01 and 02, add visual styling
Output: Updated astro.config.mjs with plugins, new gsd-blocks.css stylesheet
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-prettier-rendering/06-RESEARCH.md
@.planning/phases/06-prettier-rendering/06-01-SUMMARY.md
@.planning/phases/06-prettier-rendering/06-02-SUMMARY.md
@astro.config.mjs
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update astro.config.mjs with plugins</name>
  <files>astro.config.mjs</files>
  <action>
Update astro.config.mjs to register the GSD plugins:

1. Add imports at top of file:
```javascript
import { remarkGsdLinks } from './src/plugins/remark-gsd-links.js';
import { rehypeGsdBlocks } from './src/plugins/rehype-gsd-blocks.js';
import rehypeRaw from 'rehype-raw';
```

2. Update markdown configuration:
```javascript
markdown: {
  remarkPlugins: [
    remarkGsdLinks  // Transform @path patterns before HTML conversion
  ],
  remarkRehype: {
    allowDangerousHtml: true  // Required for rehype-raw to parse XML tags
  },
  rehypePlugins: [
    rehypeRaw,        // Parse XML-like tags as elements (MUST come first)
    rehypeGsdBlocks,  // Style GSD blocks (after rehype-raw)
    relativeLinks     // Keep existing relative links plugin (last)
  ],
  shikiConfig: {
    // ... keep existing shiki config unchanged
  }
}
```

IMPORTANT plugin order:
- remarkGsdLinks runs on markdown AST (before HTML conversion)
- rehypeRaw runs first in rehype chain (parses raw HTML)
- rehypeGsdBlocks runs after rehypeRaw (transforms parsed elements)
- relativeLinks runs last (fixes up relative link paths)
  </action>
  <verify>
Run `npm run dev` - server should start without errors.
Check console for any plugin-related warnings.
  </verify>
  <done>Astro config updated with proper plugin order and allowDangerousHtml enabled</done>
</task>

<task type="auto">
  <name>Task 2: Create gsd-blocks.css stylesheet</name>
  <files>src/styles/gsd-blocks.css</files>
  <action>
Create `src/styles/gsd-blocks.css` with styles for all GSD blocks:

```css
/* ============================================
   GSD Block Styles
   ============================================ */

/* Base block styles */
.gsd-block {
  margin: var(--spacing-lg) 0;
  padding: var(--spacing-md);
  border-radius: 6px;
  border-left: 4px solid;
}

/* Block header */
.gsd-header {
  font-weight: 600;
  font-size: var(--font-size-sm);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--spacing-sm);
  color: var(--text-secondary);
}

/* Objective block - blue accent */
.gsd-objective {
  background-color: rgba(59, 130, 246, 0.08);
  border-color: #3b82f6;
}

.dark .gsd-objective {
  background-color: rgba(59, 130, 246, 0.15);
}

/* Process block - purple accent */
.gsd-process {
  background-color: rgba(139, 92, 246, 0.08);
  border-color: #8b5cf6;
}

.dark .gsd-process {
  background-color: rgba(139, 92, 246, 0.15);
}

/* Success criteria - green accent */
.gsd-success_criteria {
  background-color: rgba(34, 197, 94, 0.08);
  border-color: #22c55e;
}

.dark .gsd-success_criteria {
  background-color: rgba(34, 197, 94, 0.15);
}

/* Context block - amber accent */
.gsd-context {
  background-color: rgba(245, 158, 11, 0.08);
  border-color: #f59e0b;
}

.dark .gsd-context {
  background-color: rgba(245, 158, 11, 0.15);
}

/* Tasks block - slate accent */
.gsd-tasks {
  background-color: rgba(100, 116, 139, 0.08);
  border-color: #64748b;
}

.dark .gsd-tasks {
  background-color: rgba(100, 116, 139, 0.15);
}

/* Verification block - cyan accent */
.gsd-verification {
  background-color: rgba(6, 182, 212, 0.08);
  border-color: #06b6d4;
}

.dark .gsd-verification {
  background-color: rgba(6, 182, 212, 0.15);
}

/* Output block - pink accent */
.gsd-output {
  background-color: rgba(236, 72, 153, 0.08);
  border-color: #ec4899;
}

.dark .gsd-output {
  background-color: rgba(236, 72, 153, 0.15);
}

/* Task items */
.gsd-task {
  background-color: var(--bg-secondary);
  border-color: var(--border-color);
  margin: var(--spacing-sm) 0;
}

.gsd-task-auto {
  border-color: #22c55e;
}

.gsd-task-checkpoint\:human-verify {
  border-color: #f59e0b;
}

.gsd-task-checkpoint\:decision {
  border-color: #8b5cf6;
}

.gsd-task-checkpoint\:human-action {
  border-color: #ef4444;
}

/* Collapsible blocks (execution_context) */
.gsd-collapsible {
  margin: var(--spacing-lg) 0;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background-color: var(--bg-secondary);
}

.gsd-collapsible .gsd-summary {
  padding: var(--spacing-sm) var(--spacing-md);
  cursor: pointer;
  font-weight: 600;
  font-size: var(--font-size-sm);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-secondary);
  list-style: none;
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.gsd-collapsible .gsd-summary::-webkit-details-marker {
  display: none;
}

.gsd-collapsible .gsd-summary::before {
  content: '>';
  display: inline-block;
  transition: transform var(--transition-fast);
  font-family: monospace;
}

.gsd-collapsible[open] .gsd-summary::before {
  transform: rotate(90deg);
}

.gsd-collapsible .gsd-content {
  padding: var(--spacing-md);
  border-top: 1px solid var(--border-color);
}

/* Execution context specific styling - gray/muted */
.gsd-execution_context {
  background-color: transparent;
}

.gsd-execution_context .gsd-content {
  background-color: var(--bg-secondary);
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
}

/* External file references */
.gsd-external-ref {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
  font-size: 0.85em;
  padding: 0.15em 0.4em;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 3px;
  color: var(--text-secondary);
  white-space: nowrap;
}

/* Internal planning links - match regular links but add subtle indicator */
.markdown-content a[href^="/"] {
  /* Uses default link styling from global.css */
}

/* Nested content in blocks */
.gsd-block p:last-child,
.gsd-content p:last-child {
  margin-bottom: 0;
}

.gsd-block ul,
.gsd-block ol,
.gsd-content ul,
.gsd-content ol {
  margin-bottom: 0;
}

/* Code blocks inside GSD blocks */
.gsd-block pre,
.gsd-content pre {
  margin: var(--spacing-sm) 0;
}
```
  </action>
  <verify>File exists at src/styles/gsd-blocks.css and contains styles for all defined block types</verify>
  <done>Complete CSS stylesheet for all GSD block types with light/dark theme support</done>
</task>

<task type="auto">
  <name>Task 3: Import gsd-blocks.css in global.css</name>
  <files>src/styles/global.css</files>
  <action>
Add import at the TOP of src/styles/global.css (before any other rules):

```css
@import './gsd-blocks.css';
```

This ensures GSD block styles are loaded with the global stylesheet.
  </action>
  <verify>
Check that global.css starts with the import statement.
Run `npm run dev` and visit a page with GSD blocks - styles should apply.
  </verify>
  <done>GSD block styles integrated into global stylesheet</done>
</task>

</tasks>

<verification>
1. Dev server starts without errors: `npm run dev`
2. Navigate to a .planning page that has `<objective>` or `<execution_context>` blocks
3. Verify visual styling applied (colored borders, backgrounds)
4. Verify execution_context is collapsible and works
5. Test @.planning/ links are clickable
6. Test @/absolute/path renders as styled indicator (not link)
7. Test in both light and dark themes
</verification>

<success_criteria>
- astro.config.mjs has both plugins registered in correct order
- allowDangerousHtml is enabled in remarkRehype config
- gsd-blocks.css exists with styles for all block types
- global.css imports gsd-blocks.css
- Visual rendering works in browser for all requirements
</success_criteria>

<output>
After completion, create `.planning/phases/06-prettier-rendering/06-03-SUMMARY.md`
</output>
