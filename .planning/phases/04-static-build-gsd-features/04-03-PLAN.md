---
phase: 04-static-build-gsd-features
plan: 03
type: execute
wave: 2
depends_on:
  - "04-02"
files_modified:
  - src/pages/timeline.astro
  - src/lib/milestones.js
  - src/components/Sidebar.astro
autonomous: true

must_haves:
  truths:
    - "Milestone timeline page shows completed vs active milestones chronologically"
    - "Active milestone is visually emphasized with accent styling"
    - "Timeline cards are expandable to show phase details"
    - "Timeline page is accessible from sidebar navigation"
  artifacts:
    - path: "src/pages/timeline.astro"
      provides: "Milestone timeline page"
      min_lines: 50
    - path: "src/lib/milestones.js"
      provides: "ROADMAP.md parser for milestone/phase data"
      exports: ["getMilestones"]
    - path: "src/components/Sidebar.astro"
      provides: "Timeline link in navigation"
      contains: "timeline"
  key_links:
    - from: "src/pages/timeline.astro"
      to: "src/lib/milestones.js"
      via: "import getMilestones"
      pattern: "import.*getMilestones"
    - from: "src/lib/milestones.js"
      to: "ROADMAP.md"
      via: "content collection"
      pattern: "getEntry.*ROADMAP"
---

<objective>
Create milestone timeline page showing project history with phases and completion status.

Purpose: GSD projects track work through milestones and phases. The timeline page provides a visual history of completed work and shows what's currently active - essential for teams and stakeholders to understand project progress.

Output: /timeline page with vertical timeline, expandable milestone cards, and phase status indicators.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-static-build-gsd-features/04-RESEARCH.md
@.planning/phases/04-static-build-gsd-features/04-CONTEXT.md

Reference existing code:
@src/layouts/DocLayout.astro — Layout to use
@src/components/Sidebar.astro — Navigation tree (add timeline link)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create milestone parser (milestones.js)</name>
  <files>src/lib/milestones.js</files>
  <action>
Create milestones.js to parse ROADMAP.md and extract phase/milestone data:

```javascript
/**
 * Parse ROADMAP.md to extract milestone and phase data for timeline
 */

import { getEntry } from 'astro:content';

/**
 * @typedef {Object} Phase
 * @property {number} number - Phase number
 * @property {string} name - Phase name
 * @property {string} description - Brief description
 * @property {boolean} complete - Whether phase is complete
 * @property {string} [completedDate] - Completion date if available
 */

/**
 * @typedef {Object} Milestone
 * @property {string} version - Version string (e.g., "v1.0")
 * @property {string} name - Milestone name
 * @property {string} status - 'active' | 'complete'
 * @property {boolean} active - Whether this is the current milestone
 * @property {number} phaseCount - Total phases
 * @property {number} completedPhases - Completed phase count
 * @property {Phase[]} phases - Array of phases
 * @property {string} description - Milestone description
 */

/**
 * Parse ROADMAP.md to extract milestones and phases
 * @returns {Promise<Milestone[]>} Array of milestones, newest first
 */
export async function getMilestones() {
  const roadmap = await getEntry('planning', 'ROADMAP');

  if (!roadmap) {
    console.warn('ROADMAP.md not found in .planning - timeline will be empty');
    return [];
  }

  const body = roadmap.body;
  const phases = parsePhases(body);

  if (phases.length === 0) {
    return [];
  }

  // For v1, we have a single "active" milestone containing all phases
  // Future: Parse milestones/ folder for versioned releases
  const completedPhases = phases.filter(p => p.complete).length;
  const allComplete = completedPhases === phases.length;

  return [{
    version: 'v1.0',
    name: 'Initial Release',
    status: allComplete ? 'complete' : 'active',
    active: !allComplete,
    phaseCount: phases.length,
    completedPhases,
    phases,
    description: 'First production release of living-library'
  }];
}

/**
 * Parse phase data from ROADMAP.md body
 * Looks for patterns like:
 * - [x] **Phase 1: CLI Foundation** - Description
 * - [ ] **Phase 2: Content Navigation** - Description
 *
 * Also parses Progress table for completion dates
 *
 * @param {string} body - Markdown body content
 * @returns {Phase[]}
 */
function parsePhases(body) {
  const phases = [];

  // Match phase checkboxes in Phases section
  // Pattern: - [x] **Phase N: Name** - Description
  // Or: - [x] **Phase N: Name** — Description (em dash)
  const phaseRegex = /^- \[(x| )\] \*\*Phase (\d+): ([^*]+)\*\*\s*[-—]\s*(.+)$/gm;

  let match;
  while ((match = phaseRegex.exec(body)) !== null) {
    phases.push({
      number: parseInt(match[2], 10),
      name: match[3].trim(),
      description: match[4].trim(),
      complete: match[1] === 'x',
      completedDate: undefined
    });
  }

  // Try to find completion dates from Progress table
  // Pattern: | 1. Name | 3/3 | ✓ Complete | 2026-01-24 |
  const tableRegex = /\|\s*\d+\.\s*([^|]+)\s*\|\s*\d+\/\d+\s*\|\s*✓\s*Complete\s*\|\s*(\d{4}-\d{2}-\d{2})\s*\|/g;

  while ((match = tableRegex.exec(body)) !== null) {
    const tableName = match[1].trim();
    const date = match[2];

    // Find matching phase by name
    const phase = phases.find(p => tableName.toLowerCase().includes(p.name.toLowerCase().split(' ')[0]));
    if (phase) {
      phase.completedDate = date;
    }
  }

  return phases.sort((a, b) => a.number - b.number);
}
```
  </action>
  <verify>Import works: `import { getMilestones } from './lib/milestones.js'` doesn't throw</verify>
  <done>milestones.js exports getMilestones() that parses ROADMAP.md into structured data</done>
</task>

<task type="auto">
  <name>Task 2: Create timeline page</name>
  <files>src/pages/timeline.astro</files>
  <action>
Create timeline.astro with vertical timeline layout using native HTML details/summary:

```astro
---
/**
 * Milestone Timeline Page
 * Shows project history with expandable milestone cards
 */

import DocLayout from '../layouts/DocLayout.astro';
import { getMilestones } from '../lib/milestones.js';
import { buildNavTree } from '../lib/navigation.js';
import { getCollection } from 'astro:content';

const milestones = await getMilestones();
const entries = await getCollection('planning');
const navTree = buildNavTree(entries);
---

<DocLayout title="Timeline" navTree={navTree} currentPath="/timeline">
  <div class="timeline-page">
    <header class="timeline-header">
      <h1>Project Timeline</h1>
      <p class="timeline-subtitle">Milestone and phase history</p>
    </header>

    {milestones.length === 0 ? (
      <div class="empty-state">
        <p>No milestones found. Add phases to your ROADMAP.md to see them here.</p>
      </div>
    ) : (
      <div class="timeline">
        {milestones.map((milestone) => (
          <details
            class:list={['timeline-item', { active: milestone.active }]}
            open={milestone.active}
          >
            <summary class="milestone-card">
              <div class="milestone-header">
                <span class="version">{milestone.version}</span>
                <span class:list={['status-badge', milestone.status]}>
                  {milestone.active ? 'Current' : 'Complete'}
                </span>
              </div>
              <h2 class="milestone-title">{milestone.name}</h2>
              <div class="milestone-meta">
                <span class="phase-count">
                  {milestone.completedPhases}/{milestone.phaseCount} phases complete
                </span>
              </div>
              <p class="milestone-description">{milestone.description}</p>
            </summary>

            <div class="milestone-content">
              <h3 class="phases-heading">Phases</h3>
              <ul class="phase-list">
                {milestone.phases.map((phase) => (
                  <li class:list={['phase-item', { complete: phase.complete }]}>
                    <span class="phase-status">
                      {phase.complete ? '✓' : '○'}
                    </span>
                    <div class="phase-info">
                      <span class="phase-name">
                        Phase {phase.number}: {phase.name}
                      </span>
                      <span class="phase-description">{phase.description}</span>
                      {phase.completedDate && (
                        <span class="phase-date">Completed {phase.completedDate}</span>
                      )}
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </details>
        ))}
      </div>
    )}
  </div>
</DocLayout>

<style>
  .timeline-page {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--spacing-lg);
  }

  .timeline-header {
    margin-bottom: var(--spacing-xl);
  }

  .timeline-header h1 {
    margin: 0 0 var(--spacing-sm);
    font-size: 2rem;
  }

  .timeline-subtitle {
    color: var(--text-muted);
    margin: 0;
  }

  .empty-state {
    text-align: center;
    padding: var(--spacing-xl);
    color: var(--text-muted);
    border: 2px dashed var(--border-color);
    border-radius: 8px;
  }

  /* Timeline container */
  .timeline {
    position: relative;
    padding-left: 2rem;
  }

  /* Vertical line */
  .timeline::before {
    content: '';
    position: absolute;
    left: 0.5rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border-color);
  }

  /* Timeline item */
  .timeline-item {
    position: relative;
    margin-bottom: var(--spacing-lg);
    list-style: none;
  }

  /* Timeline dot */
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -1.75rem;
    top: 1.5rem;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--bg-primary);
    border: 2px solid var(--text-muted);
    z-index: 1;
  }

  .timeline-item.active::before {
    background: var(--link-color);
    border-color: var(--link-color);
    width: 16px;
    height: 16px;
    left: -1.85rem;
  }

  /* Milestone card (summary) */
  .milestone-card {
    display: block;
    padding: var(--spacing-lg);
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    list-style: none;
  }

  .milestone-card::-webkit-details-marker {
    display: none;
  }

  .milestone-card:hover {
    border-color: var(--link-color);
  }

  .timeline-item.active .milestone-card {
    border-color: var(--link-color);
    border-width: 2px;
    background: var(--bg-primary);
  }

  .milestone-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
  }

  .version {
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    color: var(--text-muted);
  }

  .status-badge {
    font-size: var(--font-size-sm);
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 500;
  }

  .status-badge.active {
    background: var(--link-color);
    color: white;
  }

  .status-badge.complete {
    background: var(--bg-secondary);
    color: var(--text-muted);
    border: 1px solid var(--border-color);
  }

  .milestone-title {
    margin: 0 0 var(--spacing-sm);
    font-size: 1.25rem;
  }

  .milestone-meta {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
    margin-bottom: var(--spacing-sm);
  }

  .milestone-description {
    margin: 0;
    color: var(--text-secondary);
  }

  /* Expand indicator */
  .milestone-card::after {
    content: '▶';
    position: absolute;
    right: var(--spacing-lg);
    top: var(--spacing-lg);
    font-size: 0.75rem;
    color: var(--text-muted);
    transition: transform 0.2s;
  }

  .timeline-item[open] .milestone-card::after {
    transform: rotate(90deg);
  }

  /* Expanded content */
  .milestone-content {
    padding: var(--spacing-lg);
    padding-top: 0;
    margin-top: var(--spacing-md);
  }

  .phases-heading {
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin: 0 0 var(--spacing-md);
  }

  .phase-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .phase-item {
    display: flex;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) 0;
    border-bottom: 1px solid var(--border-color);
  }

  .phase-item:last-child {
    border-bottom: none;
  }

  .phase-status {
    flex-shrink: 0;
    width: 1.5rem;
    text-align: center;
    color: var(--text-muted);
  }

  .phase-item.complete .phase-status {
    color: var(--link-color);
  }

  .phase-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .phase-name {
    font-weight: 500;
  }

  .phase-item.complete .phase-name {
    color: var(--text-muted);
  }

  .phase-description {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
  }

  .phase-date {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
    font-style: italic;
  }
</style>
```
  </action>
  <verify>Navigate to /timeline in dev server - page renders without errors</verify>
  <done>Timeline page displays milestones with expandable phase details</done>
</task>

<task type="auto">
  <name>Task 3: Add timeline link to sidebar navigation</name>
  <files>src/components/Sidebar.astro</files>
  <action>
Add a "Timeline" link to the sidebar, positioned after root docs but before GSD Structure section.

1. In Sidebar.astro, after the regularNodes map (root files) and before the gsdNodes section, add:

```astro
{/* Timeline link - special page */}
<li class="nav-item">
  <a
    href="/timeline"
    aria-current={currentPath === '/timeline' ? 'page' : undefined}
    class:list={['nav-link', { current: currentPath === '/timeline' }]}
  >
    <svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true" class="nav-icon">
      <circle cx="4" cy="4" r="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <circle cx="4" cy="12" r="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <path d="M4 6v4M8 4h5M8 12h5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <span>Timeline</span>
  </a>
</li>
```

This adds a timeline icon (vertical dots with lines) and places it consistently with the other root-level navigation items.
  </action>
  <verify>Dev server shows "Timeline" link in sidebar, clicking navigates to /timeline</verify>
  <done>Timeline page accessible from sidebar navigation with consistent icon styling</done>
</task>

</tasks>

<verification>
1. Run dev server and navigate to /timeline
2. Timeline shows v1.0 milestone with "Current" badge
3. Phases from ROADMAP.md are listed with completion status
4. Click milestone card to expand/collapse phase list
5. Completed phases show checkmark, completion date if available
6. Timeline link in sidebar has icon, highlights when on /timeline page
7. Page works in both light and dark themes
</verification>

<success_criteria>
- /timeline page renders milestone timeline from ROADMAP.md
- Active milestone shows "Current" badge with accent styling
- Milestone cards expand to show phase details
- Timeline accessible from sidebar with distinctive icon
- Empty state shown if no milestones found
</success_criteria>

<output>
After completion, create `.planning/phases/04-static-build-gsd-features/04-03-SUMMARY.md`
</output>
